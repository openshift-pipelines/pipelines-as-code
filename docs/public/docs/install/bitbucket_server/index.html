<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Install Pipelines-As-Code for Bitbucket Server #  Pipelines-As-Code has a full support of Bitbucket Server.
Following the infrastructure installation :
 You will have to generate a personal token as the manager of the Project, follow the steps here :  https://confluence.atlassian.com/bitbucketserver/personal-access-tokens-939515499.html
The token will need to have the PROJECT_ADMIN and REPOSITORY_ADMIN permissions.
Note that the token needs to be able to have access to the forked repository in pull requests or it would not be able to process and access the pull request.">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="" />
<meta property="og:description" content="Install Pipelines-As-Code for Bitbucket Server #  Pipelines-As-Code has a full support of Bitbucket Server.
Following the infrastructure installation :
 You will have to generate a personal token as the manager of the Project, follow the steps here :  https://confluence.atlassian.com/bitbucketserver/personal-access-tokens-939515499.html
The token will need to have the PROJECT_ADMIN and REPOSITORY_ADMIN permissions.
Note that the token needs to be able to have access to the forked repository in pull requests or it would not be able to process and access the pull request." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/docs/install/bitbucket_server/" /><meta property="article:section" content="docs" />

<meta property="article:modified_time" content="2022-03-28T15:48:45+02:00" />

<title>Bitbucket Server | Pipelines as Code</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.82c5dbd23447cee0b4c2aa3ed08ce0961faa40e1fa370eee4f8c9f02e0d46b5f.css" >
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.7572659263b1daafc3e4d5bb97e500a1612f03dfc5e11d1be8033a18685aa68a.js" ></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><img src="/pipelines-logo.svg" alt="Logo" /><span>Pipelines as Code</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/install/" class="">Installation</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/install/github_apps/" class="">Github Apps</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/install/github_webhook/" class="">Github Webhook</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/install/gitlab/" class="">Gitlab</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/install/bitbucket_cloud/" class="">Bitbucket Cloud</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/install/bitbucket_server/" class=" active">Bitbucket Server</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/guide/" class="">Usage Guide</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/guide/resolver/" class="">Resolver</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/guide/cli/" class="">CLI tkn-pac</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Bitbucket Server</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#install-pipelines-as-code-for-bitbucket-server">Install Pipelines-As-Code for Bitbucket Server</a>
      <ul>
        <li><a href="#notes">Notes</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="install-pipelines-as-code-for-bitbucket-server">
  Install Pipelines-As-Code for Bitbucket Server
  <a class="anchor" href="#install-pipelines-as-code-for-bitbucket-server">#</a>
</h1>
<p>Pipelines-As-Code has a full support of <a href="https://www.atlassian.com/software/bitbucket/enterprise">Bitbucket
Server</a>.</p>
<p>Following the <a href="install.md#install-pipelines-as-code-infrastructure">infrastructure installation</a> :</p>
<ul>
<li>You will have to generate a personal token as the manager of the Project,
follow the steps here :</li>
</ul>
<p><a href="https://confluence.atlassian.com/bitbucketserver/personal-access-tokens-939515499.html">https://confluence.atlassian.com/bitbucketserver/personal-access-tokens-939515499.html</a></p>
<p>The token will need to have the <code>PROJECT_ADMIN</code> and <code>REPOSITORY_ADMIN</code> permissions.</p>
<p>Note that the token needs to be able to have access to the forked repository in
pull requests or it would not be able to process and access the pull request.</p>
<p>Make sure you note somewhere the generated token or otherwise you will have to
recreate it.</p>
<ul>
<li>Create a Webhook on the repository following this guide :</li>
</ul>
<p><a href="https://support.atlassian.com/bitbucket-cloud/docs/manage-webhooks/">https://support.atlassian.com/bitbucket-cloud/docs/manage-webhooks/</a></p>
<ul>
<li>Add a Secret or generate a random one with :</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>  openssl rand -hex <span style="color:#ae81ff">20</span>
</span></span></code></pre></div><ul>
<li>
<p>Set the URL to the event listener public URL. On OpenShift you can get the
public URL of the Pipelines-as-Code route like this :</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#111">echo</span> https://<span style="color:#00a8c8">$(</span>oc get route -n pipelines-as-code el-pipelines-as-code-interceptor -o <span style="color:#111">jsonpath</span><span style="color:#f92672">=</span><span style="color:#d88200">&#39;{.spec.host}&#39;</span><span style="color:#00a8c8">)</span>
</span></span></code></pre></div></li>
<li>
<p>Install the secret in the pipelines-as-code namespace (we currently only
supports one webhook secret per cluster ) :</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>kubectl -n pipelines-as-code create secret generic pipelines-as-code-secret <span style="color:#8045ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#8045ff"></span>        --from-literal webhook.secret<span style="color:#f92672">=</span><span style="color:#d88200">&#34;</span><span style="color:#111">$WEBHOOK_SECRET_AS_GENERATED</span><span style="color:#d88200">&#34;</span>
</span></span></code></pre></div><ul>
<li>
<p><a href="/images/bitbucket-server-create-webhook.png">Refer to this screenshot</a> on
which events to handle on the Webhook. The individual events to select are :</p>
<ul>
<li>Repository -&gt; Push</li>
<li>Repository -&gt; Modified</li>
<li>Pull Request -&gt; Opened</li>
<li>Pull Request -&gt; Source branch updated</li>
<li>Pull Request -&gt; Comments added</li>
</ul>
</li>
<li>
<p>And finally create Repository CRD with the secret field referencing it.</p>
<ul>
<li>Here is an example of a Repository CRD :</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#111">---</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span><span style="color:#111">:</span> <span style="color:#d88200">&#34;pipelinesascode.tekton.dev/v1alpha1&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span><span style="color:#111">:</span> <span style="color:#ae81ff">Repository</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span><span style="color:#111">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span><span style="color:#111">:</span> <span style="color:#ae81ff">my-repo</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span><span style="color:#111">:</span> <span style="color:#ae81ff">target-namespace</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span><span style="color:#111">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">url</span><span style="color:#111">:</span> <span style="color:#d88200">&#34;https://bitbucket.com/workspace/repo&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">git_provider</span><span style="color:#111">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">url</span><span style="color:#111">:</span> <span style="color:#d88200">&#34;https://bitbucket.server.api.url&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">user</span><span style="color:#111">:</span> <span style="color:#d88200">&#34;yourbitbucketusername&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">secret</span><span style="color:#111">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span><span style="color:#111">:</span> <span style="color:#d88200">&#34;bitbucket-server-token&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># Set this if you have a different key in your secret</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e"># key: &#34;token&#34;</span>
</span></span></code></pre></div><h2 id="notes">
  Notes
  <a class="anchor" href="#notes">#</a>
</h2>
<ul>
<li>
<p><code>git_provider.secret</code> cannot reference a secret in another namespace,
Pipelines as code assumes always it will be the same namespace as where the
repository has been created.</p>
</li>
<li>
<p><code>tkn-pac create</code> and <code>bootstrap</code> is not supported on Bitbucket Server.</p>
</li>
</ul>
<blockquote class="book-hint danger">
  <ul>
<li>You can only reference user by the <code>ACCOUNT_ID</code> in owner file.</li>
</ul>

</blockquote>

</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/openshift-pipelines/pipelines-as-code/commit/7b7c719d12a60c05f73e659bff6753b531fd92ef" title='Last modified by Chmouel Boudjnah | March 28, 2022' target="_blank" rel="noopener">
      <img src="/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>March 28, 2022</span>
    </a>
  </div>



  <div>
    <a class="flex align-center" href="https://github.com/openshift-pipelines/pipelines-as-code/edit/main/docs/content/docs/install/bitbucket_server.md" target="_blank" rel="noopener">
      <img src="/svg/edit.svg" class="book-icon" alt="Edit" />
      <span>Edit this page</span>
    </a>
  </div>


</div>



  <script>(function(){function e(n){const e=window.getSelection(),t=document.createRange();t.selectNodeContents(n),e.removeAllRanges(),e.addRange(t)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#install-pipelines-as-code-for-bitbucket-server">Install Pipelines-As-Code for Bitbucket Server</a>
      <ul>
        <li><a href="#notes">Notes</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












